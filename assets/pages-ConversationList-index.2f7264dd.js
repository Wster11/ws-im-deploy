import{d as e,a,y as t,z as s,A as n,B as o,o as l,c as r,w as i,b as c,e as u,t as d,h as v,g as p,k as f,D as m,E as g,r as A,F as h,G as _,H as y,J as w,s as C,l as k,K as I}from"./index-d37a6b04.js";import{A as M,d as x}from"./defaultAvatar.12922afc.js";import{d as R}from"./defaultGroupAvatar.4ee83176.js";import{_ as S}from"./_plugin-vue_export-helper.1b428a4d.js";const W=S(e({__name:"index",props:{conversation:{}},setup(e){const{t:m}=a(),g=e,A=t(),h=s(),_=n((()=>{const e=g.conversation.conversationId;if("groupChat"===g.conversation.conversationType){const a=h.getGroupInfoFromStore(e);return{name:null==a?void 0:a.groupName,avatar:""}}return A.getUserInfoFromStore(e)})),{getConversationTime:y}=o(),w=()=>{uni.navigateTo({url:`../../pages/Chat/index?type=${g.conversation.conversationType}&id=${g.conversation.conversationId}`})},C=e=>{var a,t,s,n;let o="";switch(null==(a=e.lastMessage)?void 0:a.type){case"txt":o="the combine message"==(null==(t=e.lastMessage)?void 0:t.msg)?`/${m("chatHistory")}/`:null==(s=e.lastMessage)?void 0:s.msg;break;case"img":o=`/${m("image")}/`;break;case"audio":o=`/${m("audio")}/`;break;case"file":o=`/${m("file")}/`;break;case"video":o=`/${m("video")}/`;break;case"custom":o="userCard"==e.lastMessage.customEvent?`/${m("contact")}/`:`/${m("custom")}/`;break;case"combine":o=`/${m("chatHistory")}/`;break;default:console.warn("unexpected message type:",null==(n=e.lastMessage)?void 0:n.type)}return o};return(e,a)=>{const t=f;return l(),r(t,{class:"conversation-item-wrap",onClick:w},{default:i((()=>[c(t,{class:"avatar-wrap"},{default:i((()=>[c(M,{src:_.value.avatar,placeholder:"groupChat"===g.conversation.conversationType?R:x},null,8,["src","placeholder"]),e.conversation.unReadCount>0?(l(),r(t,{key:0,class:"unread-count"},{default:i((()=>[u(d(e.conversation.unReadCount>99?"99+":e.conversation.unReadCount),1)])),_:1})):v("",!0)])),_:1}),c(t,{class:"content-wrap"},{default:i((()=>[c(t,{class:"user-info-wrap"},{default:i((()=>[c(t,{class:"user-nick-name ellipsis"},{default:i((()=>[u(d(_.value.name),1)])),_:1}),c(t,{class:"msg-wrap"},{default:i((()=>[c(t,{class:"last-msg ellipsis"},{default:i((()=>[u(d(C(e.conversation)),1)])),_:1})])),_:1})])),_:1}),c(t,{class:"time"},{default:i((()=>[u(d(p(y)(e.conversation.lastMessage)),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-4e5cf500"]]),b=S(e({__name:"index",setup(e){const a=s(),t=m(),{contactsNoticeInfo:o}=t,{groupNoticeInfo:A}=a,h=n((()=>{var e,a;const t=(null==(e=o.list[0])?void 0:e.time)||0,s=(null==(a=A.list[0])?void 0:a.time)||0,n=Math.max(t,s);return{unReadCount:o.unReadCount+A.unReadCount,time:g(n)}})),_=()=>{uni.switchTab({url:"../../pages/User/index"})};return(e,a)=>{const t=f;return l(),r(t,{class:"conversation-item-wrap",onClick:_},{default:i((()=>[c(t,{class:"avatar-wrap"},{default:i((()=>[c(M,{src:p("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAaVBMVEUAAAAAWf8AWv8AWf8AWf8AWf8AWv8AWv8AUv8AWf8AWv8AWf8AWf8AWf8AXP8AWf/5+vpwqv+20v8AZP8Abv+kyP9doP9Llv/X5v3o8PyTvv9Jlv/H3f6Bs//n8PuBtP9vq/8dgv/X5f2YyNTWAAAAD3RSTlMA3yCf75BwQBDPv7+vgDBLvpgJAAABQUlEQVRIx+3XyW6EMAyA4YSwhGXGDmEfZrq8/0MW0UNZYgiueut//2SQUGLETzqJVZFKCY6kzHMVJ8JREIVwWqiCDdMReHZbj5PgnVwMvROOkPf1PMZMytFSz+4Gl4vmBwVGwQQVAG9kyIGhFgmwSkTMg/HBK1ZdVwGVEjlQGUQDVAUXptRnY5u6R+zLlnhaScBmUt+9DAHB1YCLSguOnPCJq0pf+MBNjSfstvBlveAH7mq9oNnDwQvWe1h6wfIf/gEc93D0gRU6sh5wcMH6FNonOnuzJ7BDotEewgeStYfQ0NBsoIRllSGrdqccKylScFeT38xcJgqYok+sloQKiN4/EfsGiBT7muNfrJp3lQshIg5U/HWFGOm1QurrKxl7CeSunb9ddK+tkJEW6wLls8xHgXCUxCrLqN+HtFBxspj2BYZKrGbyYG3XAAAAAElFTkSuQmCC")},null,8,["src"]),h.value.unReadCount>0?(l(),r(t,{key:0,class:"unread-count"},{default:i((()=>[u(d(h.value.unReadCount>99?"99+":h.value.unReadCount),1)])),_:1})):v("",!0)])),_:1}),c(t,{class:"content-wrap"},{default:i((()=>[c(t,{class:"user-info-wrap"},{default:i((()=>[c(t,{class:"user-nick-name ellipsis"},{default:i((()=>[u(d(e.$t("systemNotice")),1)])),_:1}),c(t,{class:"msg-wrap"},{default:i((()=>[c(t,{class:"last-msg ellipsis"},{default:i((()=>[u(d(e.$t("newNoticeTip")),1)])),_:1})])),_:1})])),_:1}),c(t,{class:"time"},{default:i((()=>[u(d(h.value.time),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-f086ad15"]]),E=S(e({__name:"index",props:{conversation:{},popStyle:{}},emits:["onMenuClose"],setup(e,{emit:t}){const{deleteConversation:s,markConversationRead:n}=o(),{t:v}=a(),p="DELETE",m="PIN",g="MUTE",C="MARK_READ",k=t,I=e,M=A([{name:v("markRead"),type:C},{name:v("deleteConv"),type:p}]);return(e,a)=>{const t=f;return l(),r(t,{class:"shade",onClick:a[0]||(a[0]=e=>k("onMenuClose"))},{default:i((()=>[c(t,{class:"pop show",style:w(e.popStyle)},{default:i((()=>[(l(!0),h(y,null,_(M.value,((e,a)=>(l(),r(t,{key:e.type,onClick:a=>(e=>{switch(e.type){case C:n(I.conversation);break;case p:s(I.conversation);break;case m:console.log("置顶会话");break;case g:console.log("静音会话")}k("onMenuClose")})({type:e.type}),"data-index":a},{default:i((()=>[u(d(e.name),1)])),_:2},1032,["onClick","data-index"])))),128))])),_:1},8,["style"])])),_:1})}}}),[["__scopeId","data-v-ff544b5c"]]),B=S(e({__name:"index",setup(e){const a=A(""),p=A(""),g=A({}),w=A(!1),M=s(),x=m(),R=A({width:0,height:0}),S=o(),B=t(),{getUserInfoFromStore:T}=B,G=n((()=>S.conversationList.filter((e=>{if("groupChat"===e.conversationType){const t=M.getGroupInfoFromStore(e.conversationId);return null==t?void 0:t.groupName.includes(a.value)}return T(e.conversationId).name.includes(a.value)})))),N=n((()=>x.contactsNoticeInfo.list.length||M.groupNoticeInfo.list.length)),U=e=>{let[a,t,s]=[e.touches[0],"",e.currentTarget.dataset.id];g.value=S.conversationList.find((e=>e.conversationId===s)),t=a.clientY>R.value.height/2?`bottom:${R.value.height-a.clientY}px;`:`top:${a.clientY}px;`,a.clientX>R.value.width/2?t+=`right:${R.value.width-a.clientX}px`:t+=`left:${a.clientX+20}px`,p.value=t,w.value=!0},$=()=>{w.value=!1,g.value={}};return C((()=>{uni.getSystemInfo({success:e=>{R.value.width=e.windowWidth,R.value.height=e.windowHeight}})})),(e,t)=>{const s=k,n=f;return l(),r(n,{class:"conversation-list-wrap"},{default:i((()=>[c(n,{class:"input-wrap"},{default:i((()=>[c(s,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),placeholder:e.$t("conversationSearchPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),N.value?(l(),r(b,{key:0})):v("",!0),w.value?(l(),r(E,{key:1,"pop-style":p.value,conversation:g.value,onOnMenuClose:$},null,8,["pop-style","conversation"])):v("",!0),G.value.length?(l(),r(n,{key:2},{default:i((()=>[(l(!0),h(y,null,_(G.value,(e=>(l(),r(n,{key:e.conversationId,"data-id":e.conversationId,onLongpress:U,class:I(["conversation-item-wrap",{"conversation-item-wrap-selected":e.conversationId===g.value.conversationId}])},{default:i((()=>[c(W,{conversation:e},null,8,["conversation"])])),_:2},1032,["data-id","class"])))),128))])),_:1})):(l(),r(n,{key:3,class:"conversation-empty"},{default:i((()=>[u(d(e.$t("conversationEmptyTip")),1)])),_:1}))])),_:1})}}}),[["__scopeId","data-v-dc3c9f86"]]);export{B as default};
