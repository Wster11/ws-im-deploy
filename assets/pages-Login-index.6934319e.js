import{d as e,u as a,a as l,r as o,I as t,o as n,c as s,w as r,b as i,e as d,t as c,f as u,g as p,s as v,h as m,n as h,i as f,j as g,k as y,l as k,m as w,p as C,q as _,v as b,x as I,y as P,C as V,z as x,A as $}from"./index-570604c4.js";import{_ as S}from"./_plugin-vue_export-helper.1b428a4d.js";const T=S(e({__name:"index",setup(e){const{login:S}=a(),{t:T}=l(),U=o(60),E=o(""),N=o(""),j=o(""),L=o(""),F=o(!1),M=o(0),O=o(!!t),q=()=>{const e=setInterval((()=>{U.value--,U.value<=0&&(clearInterval(e),U.value=60)}),1e3)},z=async()=>{if(!/^1[3456789]\d{9}$/.test(j.value))return v({title:T("telNumberError"),icon:"none"}),!1;try{q();const e=await m({url:`https://a1.easemob.com/inside/app/sms/send/${j.value}`,header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:j.value}});200==e.statusCode?(q(),v({title:T("sendCodeSuccess"),icon:"none"})):400==e.statusCode&&("phone number illegal"==e.data.errorInfo?v({title:T("telNumberError"),icon:"none"}):"Please wait a moment while trying to send."==e.data.errorInfo?v({title:T("sendCodeFrequent"),icon:"none"}):e.data.errorInfo.includes("exceed the limit")?v({title:T("sendCodeReachLimit"),icon:"none"}):v({title:e.data.errorInfo,icon:"none"}))}catch(e){v({title:T("sendCodeFailed"),icon:"none"})}},A=()=>{if(F.value)if(O.value){if(""===E.value)return void v({title:T("loginUserIdPlaceholder"),icon:"none"});I({title:T("loginLoadingTitle")}),S({user:E.value,pwd:N.value}).then((e=>{P({key:V,data:{userId:E.value,token:e.accessToken}}),x({url:"../ConversationList/index"})})).catch((e=>{var a,l;v({title:null==(l=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:l.error_description,icon:"none"})})).finally((()=>{$()}))}else{if(""===j.value)return void v({title:T("loginPhoneIdPlaceholder"),icon:"none"});if(""===L.value)return void v({title:T("loginCodePlaceholder"),icon:"none"});(async()=>{I({title:T("loginLoadingTitle")});try{const e=await m({url:"https://a1.easemob.com/inside/app/user/login/V2",header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:j.value,smsCode:L.value}});if(200==e.statusCode){const{token:a,chatUserName:l}=e.data;S({user:l,accessToken:a}).then((e=>{P({key:V,data:{userId:l,token:e.accessToken}}),x({url:"../ConversationList/index"})})).finally((()=>{$()}))}else if(400==e.statusCode&&e.data.errorInfo)switch(e.data.errorInfo){case"UserId password error.":v({title:T("userIdOrPasswordError"),icon:"none"});break;case"phone number illegal":v({title:T("telNumberError"),icon:"none"});break;case"SMS verification code error.":v({title:T("codeError"),icon:"none"});break;case"Sms code cannot be empty":v({title:T("codeIsEmpty"),icon:"none"});break;case"Please send SMS to get mobile phone verification code.":v({title:T("sendCodeFirst"),icon:"none"});break;default:v({title:e.data.errorInfo,icon:"none"})}}catch(e){console.log(e),v({title:T("loginFailed"),icon:"none"})}})()}else v({title:T("privacyChecked"),icon:"none"})},D=()=>{window.open("https://www.easemob.com/terms")},R=e=>{F.value=!!e.detail.value[0]},B=()=>{h({url:"../ServerConfig/index"})};return(e,a)=>{const l=f,o=g,t=y,v=k,m=w,h=C,I=_,P=b;return n(),s(t,{class:"login-wrap"},{default:r((()=>[i(t,{class:"login-header"},{default:r((()=>[i(l,{onClick:a[0]||(a[0]=e=>M.value++),src:"/static/images/logo.png",style:{width:"100px",height:"100px"}}),i(o,{class:"login-title"},{default:r((()=>[d(c(e.$t("easemob"))+" IM Demo",1)])),_:1})])),_:1}),O.value?(n(),s(t,{key:0,class:"login-form-warp"},{default:r((()=>[i(t,{class:"input-wrap"},{default:r((()=>[i(v,{modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value=e),placeholder:e.$t("loginUserIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),i(t,{class:"input-wrap"},{default:r((()=>[i(v,{type:"password",modelValue:N.value,"onUpdate:modelValue":a[2]||(a[2]=e=>N.value=e),placeholder:e.$t("loginPasswordPlaceholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1})):(n(),s(t,{key:1,class:"login-form-wrap"},{default:r((()=>[i(t,{class:"input-wrap"},{default:r((()=>[i(v,{modelValue:j.value,"onUpdate:modelValue":a[3]||(a[3]=e=>j.value=e),maxlength:"11",placeholder:e.$t("loginPhoneIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),i(t,{class:"item-wrap"},{default:r((()=>[i(v,{modelValue:L.value,"onUpdate:modelValue":a[4]||(a[4]=e=>L.value=e),placeholder:e.$t("loginCodePlaceholder")},null,8,["modelValue","placeholder"]),i(m,{size:"mini",type:"primary",class:"send-code",onClick:z,disabled:60!==U.value},{default:r((()=>[d(c(60===U.value?e.$t("sendCode"):U.value),1)])),_:1},8,["disabled"])])),_:1})])),_:1})),i(t,{class:"private-wrap"},{default:r((()=>[i(P,{onChange:R},{default:r((()=>[i(I,null,{default:r((()=>[i(h,{value:"true",checked:F.value},null,8,["checked"]),d(" "+c(e.$t("agreeTo"))+" ",1),u("a",{onClick:D},"《"+c(e.$t("privacyPolicy"))+"》",1)])),_:1})])),_:1})])),_:1}),i(m,{type:"primary",onClick:A},{default:r((()=>[d(c(e.$t("login")),1)])),_:1}),M.value>5?(n(),s(t,{key:2,class:"server-config",onClick:B},{default:r((()=>[d(c(e.$t("serverConfig")),1)])),_:1})):p("",!0)])),_:1})}}}),[["__scopeId","data-v-2456228b"]]);export{T as default};
