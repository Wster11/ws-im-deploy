import{d as A,o as e,c as s,w as a,f as t,t as o,k as l,r as n,b as i,L as r,i as u,g as c,h as g,N as d,T as m,U as p,Q as v,e as h,E as w,a as B,A as I,D as f,V as F,M as y,G as C,W as U,H as Q,J as D,K as E,X as K,Y as V,l as k,Z as R,_ as G,$ as H,a0 as x,B as T,s as Y,a1 as M}from"./index-0e812019.js";import{A as X,d as b}from"./defaultAvatar.5704f27d.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";const J=L(A({__name:"messageTxt",props:{msg:{}},setup:A=>(A,n)=>{const i=l;return e(),s(i,{class:"msg-text"},{default:a((()=>[t("span",{class:"msg"},o(A.msg.msg),1)])),_:1})}}),[["__scopeId","data-v-9dc49f14"]]),N="/assets/img404-edd00584.jpg",S=160,O=L(A({__name:"messageImage",props:{msg:{}},setup(A){const t=A,o=n(!1),c=n({width:"auto",height:"160px"}),g=()=>{o.value=!0,t.msg.thumb=N},d=()=>{o.value||uni.previewImage({urls:[t.msg.url||""]})},m=A=>{(A=>{const{width:e,height:s}=A;if(0===e||0===s)return;let a=0,t=0;e>s?(a=S,t=S*s/e):(a=S*e/s,t=S),c.value.width=a+"px",c.value.height=t+"px"})(A.detail)};return(A,t)=>{const o=u,n=l;return e(),s(n,{class:"msg-image"},{default:a((()=>[i(o,{mode:"aspectFit",style:r({width:c.value.width,height:c.value.height}),onError:g,onClick:d,onLoad:m,class:"image",src:A.msg.thumb},null,8,["style","src"])])),_:1})}}}),[["__scopeId","data-v-c41115cb"]]),W=200,q=L(A({__name:"messageVideo",props:{msg:{}},setup(A){const t=A,o=n({width:"auto",height:"200px"}),d=n(!1),m=n(!1),p=()=>{t.msg.thumb=N,d.value=!0},v=A=>{m.value=!0,(A=>{const{width:e,height:s}=A;if(0===e||0===s)return;let a=0,t=0;e>s?(a=W,t=W*s/e):(a=W*e/s,t=W),o.value.width=a+"px",o.value.height=t+"px"})(A.detail)},h=()=>{uni.navigateTo({url:`../../pages/VideoPreview/index?url=${t.msg.url}`})};return(A,t)=>{const n=u,w=l;return e(),s(w,{class:"msg-video"},{default:a((()=>[i(w,{class:"video-poster"},{default:a((()=>[i(n,{mode:"widthFix",style:r({width:o.value.width,height:o.value.height}),onError:p,onLoad:v,class:"image",src:A.msg.thumb},null,8,["style","src"]),!d.value&&m.value?(e(),s(w,{key:0,onClick:h,class:"video-play-btn"},{default:a((()=>[i(n,{class:"video-play-btn-image",src:c("/assets/videoplay-04dc316c.png")},null,8,["src"])])),_:1})):g("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-78f1c2f6"]]),j=L(A({__name:"messageAudio",props:{msg:{}},setup(A){const t=d().getChatConn(),g=A,w=new Map,B=n(!1),I=t.user===g.msg.from||""===g.msg.from,f=m(),{setPlayingAudioMessageId:F}=f,y=async()=>{if(!K()){const A=uni.createInnerAudioContext();w.set("audio",A),U(),A.src=await C()}Q()},C=()=>new Promise(((A,e)=>{const{url:s}=g.msg;uni.downloadFile({url:s||"",header:{"X-Requested-With":"XMLHttpRequest",Accept:"audio/mp3",Authorization:"Bearer "+t.token},success:e=>{const s=e.tempFilePath;A(s)},fail:A=>{console.warn("downloadFile failed",A),e(A),uni.showToast({title:"语音转mp3失败",duration:2e3})}})})),U=()=>{const A=K();A&&(B.value=!1,A.onPlay((()=>{B.value=!0})),A.onStop((()=>{B.value=!1})),A.onPause((()=>{B.value=!1})),A.onError((A=>{B.value=!1,console.warn("audio play error",A)})),A.onEnded((()=>{B.value=!1})))},Q=()=>{B.value?E():(F(g.msg.id),D())},D=()=>{var A;null==(A=K())||A.play()},E=()=>{var A;null==(A=K())||A.stop()},K=()=>w.get("audio");return p((()=>f.playingAudioMsgId),(A=>{A!==g.msg.id&&(E(),B.value=!1)})),v((()=>{var A;const e=K();B.value&&E(),null==(A=null==e?void 0:e.destroy)||A.call(e),w.delete("audio")})),(A,t)=>{const n=l,d=u;return e(),s(n,{class:"msg-audio"},{default:a((()=>[i(n,{class:"content-wrap",onClick:y},{default:a((()=>[c(I)?(e(),s(n,{key:0,class:"content",style:r({width:20*(g.msg.length||0)+"rpx"})},{default:a((()=>[i(n,null,{default:a((()=>[h(o(g.msg.length)+"'' ",1)])),_:1}),i(d,{class:"image",src:B.value?c("data:image/gif;base64,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"):c("data:image/png;base64,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"),mode:"aspectFit"},null,8,["src"])])),_:1},8,["style"])):(e(),s(n,{key:1,class:"content",style:r({width:10*(g.msg.length||0)+"rpx"})},{default:a((()=>[i(d,{class:"image",src:B.value?c("data:image/gif;base64,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"):c("data:image/png;base64,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"),mode:"aspectFit"},null,8,["src"]),i(n,null,{default:a((()=>[h(o(g.msg.length)+"''",1)])),_:1})])),_:1},8,["style"]))])),_:1})])),_:1})}}}),[["__scopeId","data-v-bf645c06"]]),Z=L(A({__name:"messageOperation",props:{msg:{},isSelf:{type:Boolean}},emits:["onFinished"],setup(A,{emit:t}){const{recallMessage:n}=m(),{getCvsIdFromMessage:u}=w(),g=t,{t:d}=B(),p=A,{msg:v,isSelf:I}=p,f=()=>{n({mid:v.id,to:u(v),chatType:v.chatType}).catch((A=>{uni.showToast({title:`${d("recallFailed")} ${A.message}`,icon:"none"})})).finally((()=>{g("onFinished")}))};return(A,t)=>{const n=l;return e(),s(n,{class:"msg-operation",style:r(c(I)?{right:0}:{left:0})},{default:a((()=>[i(n,{class:"content"},{default:a((()=>[i(n,{class:"msg-operate-item",onClick:f},{default:a((()=>[h(o(A.$t("recall")),1)])),_:1})])),_:1})])),_:1},8,["style"])}}}),[["__scopeId","data-v-f745d65a"]]),z=L(A({__name:"messageItem",props:{msg:{}},setup(A){var t;const u=n(!1),m=A,p=I(),{getUserInfoFromStore:v}=p,w=d().getChatConn().user===m.msg.from||""===m.msg.from,B=()=>{u.value=!0},C=(null==(t=m.msg.ext)?void 0:t.ease_chat_uikit_user_info)||{},U=f((()=>"img"!==m.msg.type&&"video"!==m.msg.type?"msg-bubble msg-bubble-bg":"msg-bubble"));return(A,t)=>{const n=l;return e(),s(n,{class:"msg-item-wrap",style:r({flexDirection:c(w)?"row-reverse":"row"})},{default:a((()=>[i(n,{class:"avatar-wrap"},{default:a((()=>[i(X,{src:c(v)(A.msg.from||"").avatar||c(C).avatarURL||"",placeholder:c(b)},null,8,["src","placeholder"])])),_:1}),i(n,{class:"msg-content",style:r({textAlign:c(w)?"right":"left"})},{default:a((()=>[c(w)?g("",!0):(e(),s(n,{key:0},{default:a((()=>[h(o(c(v)(A.msg.from||"").nickname||c(C).nickname),1)])),_:1})),u.value?(e(),s(n,{key:1,class:"mask",onLongpress:F((()=>{}),["stop"]),onClick:t[0]||(t[0]=A=>u.value=!u.value)})):g("",!0),i(n,{class:y(U.value),onLongpress:B},{default:a((()=>[u.value&&c(w)?(e(),s(Z,{key:0,onOnFinished:t[1]||(t[1]=A=>u.value=!1),msg:A.msg,isSelf:c(w)},null,8,["msg","isSelf"])):g("",!0),"txt"===A.msg.type?(e(),s(n,{key:1},{default:a((()=>[i(J,{msg:A.msg},null,8,["msg"])])),_:1})):"img"===A.msg.type?(e(),s(n,{key:2},{default:a((()=>[i(O,{msg:A.msg},null,8,["msg"])])),_:1})):"video"===A.msg.type?(e(),s(n,{key:3},{default:a((()=>[i(q,{msg:A.msg},null,8,["msg"])])),_:1})):"audio"===A.msg.type?(e(),s(n,{key:4},{default:a((()=>[i(j,{msg:A.msg},null,8,["msg"])])),_:1})):"custom"===A.msg.type?(e(),s(n,{key:5},{default:a((()=>[i(n,null,{default:a((()=>[h("[Custom]")])),_:1})])),_:1})):g("",!0)])),_:1},8,["class"])])),_:1},8,["style"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-931a26ae"]]),P=L(A({__name:"messageTime",props:{currTime:{},prevTime:{}},setup(A){const t=A,i=n(!1),r=n("");return p((()=>[t.currTime,t.prevTime]),((A,e)=>{var s,a;(null==A?void 0:A.toString())!==(null==e?void 0:e.toString())&&(r.value=(s=t.currTime,a=t.prevTime,i.value=!0,s<=0?"":!a||a<=0||s-a>=6e5?(i.value=!0,C(s,!0)):""))}),{immediate:!0}),(A,t)=>{const n=l;return i.value?(e(),s(n,{key:0,class:"message-time"},{default:a((()=>[h(o(r.value),1)])),_:1})):g("",!0)}}}),[["__scopeId","data-v-3b89e200"]]),_=L(A({__name:"noticeMessageItem",props:{msg:{}},setup(A){var t,n;const r=I(),u=A,{msg:d}=u,m=(null==(t=d.noticeInfo)?void 0:t.ext)||{},p=null==(n=d.noticeInfo)?void 0:n.noticeType;return(A,t)=>{const n=l;return e(),s(n,{class:"msg-notice"},{default:a((()=>[i(n,{class:"notice"},{default:a((()=>[i(n,{class:"notice-content"},{default:a((()=>[i(n,{class:"notice-text"},{default:a((()=>["recall"===c(p)?(e(),s(n,{key:0},{default:a((()=>{var e,s,a;return[h(o(`"${c(r).getUserInfoFromStore(null==(a=null==(s=null==(e=c(d))?void 0:e.noticeInfo)?void 0:s.ext)?void 0:a.from).name}" ${A.$t("recallNotice")}`),1)]})),_:1})):"group"===c(p)?(e(),s(n,{key:1},{default:a((()=>{var e,s,a;return[h(o(`"${c(r).getUserInfoFromStore(null==(a=null==(s=null==(e=c(d))?void 0:e.noticeInfo)?void 0:s.ext)?void 0:a.from).name}" ${c(m).operation} ${A.$t("group")}`),1)]})),_:1})):g("",!0)])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-c71b24a6"]]),$=L(A({__name:"messageList",props:{msgs:{},conversationId:{},conversationType:{}},setup(A,{expose:t}){const r=A,u=n(0),c=n(!1),d=n(""),p=m(),{getHistoryMessages:v}=p,w=f((()=>{var A;return null==(A=p.conversationMessagesMap.get(r.conversationId))?void 0:A.isLast})),B=f((()=>{var A;return null==(A=p.conversationMessagesMap.get(r.conversationId))?void 0:A.cursor})),I=async()=>{if(!0===c.value)return;c.value=!0;const A=r.msgs[0].id;try{await v({conversationId:r.conversationId,conversationType:r.conversationType},B.value),K((()=>{d.value=A;const e=setTimeout((()=>{c.value=!1,d.value="",clearTimeout(e)}),300)}))}catch(e){c.value=!1}},F=()=>{K((()=>{const A=setTimeout((()=>{u.value=300*r.msgs.length,clearTimeout(A)}),0)}))};return U((()=>{F()})),t({toBottomMsg:F}),(A,t)=>{const n=l,r=V;return e(),s(n,{class:"msg-list-wrap"},{default:a((()=>[i(n,{class:"tip"},{default:a((()=>[h(" 本应用仅用于环信产品功能开发测试，请勿用于非法用途。任何涉及转账、汇款、裸聊、网恋、网购退款、投资理财等统统都是诈骗，请勿相信！ ")])),_:1}),i(r,{"scroll-y":"","scroll-top":u.value,class:"message-scroll-list",style:{height:"100%"},"scroll-into-view":`msg-${d.value}`},{default:a((()=>[A.msgs&&!w.value?(e(),s(n,{key:0,class:"loadMore",onClick:I},{default:a((()=>[h(o(A.$t("loadMore")),1)])),_:1})):g("",!0),(e(!0),Q(E,null,D(A.msgs,((t,o)=>(e(),s(n,{class:"scroll-msg-item",id:`msg-${t.id}`,key:t.id},{default:a((()=>{var a;return[i(P,{"curr-time":t.time,"prev-time":o>0?A.msgs[o-1].time:0},null,8,["curr-time","prev-time"]),"notice"===(null==(a=null==t?void 0:t.noticeInfo)?void 0:a.type)?(e(),s(_,{key:0,msg:t},null,8,["msg"])):(e(),s(z,{key:1,msg:t},null,8,["msg"]))]})),_:2},1032,["id"])))),128))])),_:1},8,["scroll-top","scroll-into-view"])])),_:1})}}}),[["__scopeId","data-v-dd78b7be"]]),AA=L(A({__name:"index",emits:["onMessageSend","onShowToolbar"],setup(A,{emit:t}){const o=t,r=w(),{getSelfUserInfo:p}=I(),{sendMessage:v}=m(),{getChatSDK:h}=d(),B=n(!1),f=h(),y=n(""),C=()=>{B.value=!1,o("onShowToolbar")},U=async()=>{const A=f.message.create({to:r.currConversation.conversationId,chatType:r.currConversation.conversationType,type:"txt",msg:y.value,ext:{ease_chat_uikit_user_info:{avatarURL:p().avatar,nickname:p().name}}});y.value="";try{await v(A),K((()=>{o("onMessageSend")}))}catch(e){uni.showToast({title:`send failed: ${e.message}`,icon:"none"})}};return(A,t)=>{const o=k,n=l,r=u;return e(),s(n,{class:"message-input-wrap"},{default:a((()=>[B.value?g("",!0):(e(),s(n,{key:0,class:"send-input"},{default:a((()=>[i(o,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=A=>y.value=A),"adjust-position":!0,"auto-blur":!0,"confirm-type":"send",onConfirm:U,placeholder:A.$t("sendMessagePlaceholder")},null,8,["modelValue","placeholder"])])),_:1})),i(n,{class:"icon-wrap"},{default:a((()=>[i(r,{class:"icon",onClick:F(C,["stop"]),src:c("data:image/png;base64,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")},null,8,["src"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-a08194cd"]]),eA=L(A({__name:"itemContainer",props:{title:{},iconUrl:{}},setup(A){const t=A,{title:n,iconUrl:r}=t;return(A,t)=>{const g=u,d=l;return e(),s(d,{class:"tool-item-wrap"},{default:a((()=>[i(d,{class:"icon-wrap"},{default:a((()=>[i(g,{class:"icon",src:c(r)},null,8,["src"])])),_:1}),i(d,null,{default:a((()=>[h(o(c(n)),1)])),_:1})])),_:1})}}}),[["__scopeId","data-v-389692d7"]]),sA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAM0SURBVHgB7ZpNTttAFMffew5Sd80RzA3SG8CiLapEa2grdQc9QeEEhRMAJ4BlpZbKKVIV0QXcAG5QHyErWjV4pu8lTBpgnA97TG2Yn4SS2GPLP3vmPx8GwOPxeDwej8dTDjipwFL0ZgFSFSqkECoMauhiAOed+Mvp2HJZO5aiKNQ62NcaFqBeJERzi534U2LbSVlHKRWc1FBWCJXqnS1F70LbTqvw0+XVdTkQ6ktT696+bUfDtpEI1/jpDuF6v4eEMVQazhmNO6ChKb/4+lu2UtY2/Ozl65/w7wknx98O56EG8HUf8Mea+c1tef5mWyZ4YHjh+04DChJFUfM3NFr9wQlg9/josNLhVkj4afS2daHUCWdiE3CQfxwcSYNo5Xv8+RwqSO4qLSMx7MsOuoERwkventXx/29yC/Ow8yPcljU0teptQAUpIIytsfsBXkEFKZDSujluLzfpLlSQ3KHFT7DNMfVhTJGZQusFB6BK05YkfSOgpKzQyy0cULqrdLBmxq6j8NNNEOe2J51DurQLRXzTcIODbpj0/L2f9lrr7R9HXw/AIbmrdCeOE8L0iciNbkfEU5bNnI8aJOUvVHDGR2yBPfxCPte+jOtdJn6hflik+WNeVkUUt2kNlBxPURVFVubbMN0UVOa30s1NvInTUHikJUxaVhnFKisBp3EPSA9uloIIRmY94FDaifC02GSv2vtip31NJOayW9zXy6qLKetE+s4mD2NlLQLSXBDTxRsZYaRDyMmdCM8qayhDunThvLIG19KlCheVNYyTlr4cZqA0YVeyhizpX2ljHWagFGHXsgabNAZqpjG7c+GyZA1Gms+6TaTfd+LZhp5O++GyZQ1XI7wtyIGzJ3xXskVxIlwXWcGJsLxlhBrICm6EgYZJWWVZwUloEfY2Fcz1vyMGm1WVFRxND/upuQI14H69akF6PKlIxhPGbn+ZbkD4fHl1AwOq5JsEg0p5FVWra0vHtqaVVaXb/Dc8WCPuaKWh0uCtn21bMWuV/kOXuzcX52oFLxkhzVnffFiFT+O4a5mZ1AK5Zo2U2S1O9X9avEy8ADWAtEoeBSpmKvnWw+PxeDwezwPjLy/PrncjmFaVAAAAAElFTkSuQmCC",aA=L(A({__name:"imageUpload",props:{title:{}},setup(A){const{t:t}=B(),o=t("imageUpload"),n=R("InputToolbarEvent"),{getChatConn:r,getChatSDK:u}=d(),{sendMessage:g}=m(),{getSelfUserInfo:p}=I(),v=w(),h=r(),f=u(),F=()=>{uni.chooseImage({count:1,sourceType:["album"],success:function(A){y(A)}})},y=A=>{var e,s;const a=(null==(e=null==A?void 0:A.tempFilePaths)?void 0:e[0])||(null==(s=null==A?void 0:A.tempFiles)?void 0:s[0].tempFilePath),o=`${G}/${h.orgName}/${h.appName}/chatfiles`;if(!a)return;uni.showLoading();const l={url:o,filePath:a,fileType:"image",name:"file",header:{Authorization:"Bearer "+h.token},success:async A=>{console.log("图片上传成功",A);const e=JSON.parse(A.data),s=f.message.create({type:"img",to:v.currConversation.conversationId,chatType:v.currConversation.conversationType,url:e.uri+"/"+e.entities[0].uuid,ext:{ease_chat_uikit_user_info:{avatarURL:p().avatar,nickname:p().name}}});try{await g(s),null==n||n.onMessageSend(),null==n||n.closeToolbar()}catch(a){uni.showToast({title:`send failed: ${a.message}`,icon:"none"})}uni.hideLoading()},fail:A=>{uni.hideLoading(),uni.showToast({title:t("uploadFailed"),icon:"none"})}};uni.uploadFile(l)};return(A,t)=>{const n=l;return e(),s(n,{class:"tool-image-wrap tool-item",onClick:F},{default:a((()=>[i(eA,{title:c(o),iconUrl:c(sA)},null,8,["title","iconUrl"])])),_:1})}}}),[["__scopeId","data-v-be8ed99e"]]),tA=L(A({__name:"videoUpload",props:{title:{}},setup(A){const{t:t}=B(),o=t("videoUpload"),n=R("InputToolbarEvent"),{getChatConn:r,getChatSDK:u}=d(),{sendMessage:g}=m(),p=r(),{getSelfUserInfo:v}=I(),h=u(),f=w(),F=()=>{uni.chooseVideo({sourceType:["camera","album"],success:function(A){console.log(A,"resresresres"),y(A)}})},y=A=>{const e=null==A?void 0:A.tempFilePath,s=`${G}/${p.orgName}/${p.appName}/chatfiles`;if(!e)return;uni.showLoading();const a=p.token;console.log(a,"  token");const o={url:s,filePath:e,fileType:"video",name:"file",header:{Authorization:"Bearer "+a},success:async A=>{const e=JSON.parse(A.data),s=h.message.create({type:"video",to:f.currConversation.conversationId,chatType:f.currConversation.conversationType,file_length:A.duration,body:{url:e.uri+"/"+e.entities[0].uuid},ext:{ease_chat_uikit_user_info:{avatarURL:v().avatar,nickname:v().name}}});try{await g(s),null==n||n.onMessageSend(),null==n||n.closeToolbar()}catch(a){uni.showToast({title:`send failed: ${a.message}`,icon:"none"})}uni.hideLoading()},fail:A=>{uni.hideLoading(),uni.showToast({title:t("uploadFailed"),icon:"none"})}};uni.uploadFile(o)};return(A,t)=>{const n=l;return e(),s(n,{class:"tool-video-wrap tool-item",onClick:F},{default:a((()=>[i(eA,{title:c(o),iconUrl:c(sA)},null,8,["title","iconUrl"])])),_:1})}}}),[["__scopeId","data-v-ea1257ff"]]),oA=L(A({__name:"index",emits:["onMessageSend"],setup:(A,{emit:t})=>(A,t)=>{const o=H,n=x,r=l;return e(),s(r,{class:"message-input-toolbar"},{default:a((()=>[i(n,{class:"swiper"},{default:a((()=>[i(o,{class:"swiper-item"},{default:a((()=>[i(aA),i(tA)])),_:1})])),_:1})])),_:1})}}),[["__scopeId","data-v-6dc12f81"]]),lA=L(A({__name:"index",setup(A){const t=n(null),o=n(""),r=n(!1),u=n(""),c=m(),d=I(),p=T(),{getHistoryMessages:h}=c,{markConversationRead:B,setCurrentConversation:F}=w(),y=f((()=>{var A;return null==(A=c.conversationMessagesMap.get(o.value))?void 0:A.messages})),C=()=>{var A;null==(A=null==t?void 0:t.value)||A.toBottomMsg()},Q=()=>{!0===r.value&&(r.value=!1)};return U((()=>{if(!o.value&&!u.value)return;B({conversationId:o.value,conversationType:u.value});y.value||h({conversationId:o.value,conversationType:u.value})})),v((()=>{F(null)})),Y((A=>{var e;if(u.value=null==A?void 0:A.type,o.value=null==A?void 0:A.id,null==A?void 0:A.id){F({conversationId:o.value,conversationType:u.value});let A="";A="singleChat"===u.value?d.getUserInfoFromStore(o.value).name:(null==(e=p.getGroupInfoFromStore(o.value))?void 0:e.groupName)||"",uni.setNavigationBarTitle({title:A})}})),M("InputToolbarEvent",{onMessageSend:C,closeToolbar:Q}),(A,n)=>{const c=l;return e(),s(c,{class:"chat-wrap"},{default:a((()=>[i(c,{class:"msgs-wrap"},{default:a((()=>[r.value?(e(),s(c,{key:0,class:"mask",onClick:Q})):g("",!0),y.value?(e(),s($,{key:1,ref_key:"msgListRef",ref:t,msgs:y.value,conversationId:o.value,conversationType:u.value},null,8,["msgs","conversationId","conversationType"])):g("",!0)])),_:1}),i(c,{class:"chat-input-wrap",onClick:Q},{default:a((()=>[i(AA,{onOnMessageSend:C,onOnShowToolbar:n[0]||(n[0]=A=>r.value=!0)})])),_:1}),r.value?(e(),s(c,{key:0,class:"chat-input-toolbar-wrap"},{default:a((()=>[i(oA)])),_:1})):g("",!0)])),_:1})}}}),[["__scopeId","data-v-acf32fbe"]]);export{lA as default};
