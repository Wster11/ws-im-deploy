import{d as e,B as a,x as l,K as t,a as s,r,o as u,c as o,w as n,b as d,e as c,t as i,A as p,j as f,k as _,L as v,v as m,y as w,f as h,M as I,l as k,g,E as C,F as y,G}from"./index-4af1eaa0.js";import{A as $,d as b}from"./defaultAvatar.4a81fd72.js";import{d as U}from"./defaultGroupAvatar.4ee83176.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";const x=T(e({__name:"index",props:{searchType:{}},emits:["onCancel"],setup(e,{emit:v}){const m=e,{searchType:w}=m,{addContact:h,contacts:I}=a(),{applyJoinGroup:k}=l(),{getChatConn:g}=t(),C=g(),y=v,{t:G}=s(),T=r(""),x=r(!1),L=()=>{x.value=!0},V=()=>{y("onCancel")},S=()=>{if("contact"===w){if(T.value===C.user)return void uni.showToast({icon:"none",title:G("disabledAddSelf")});if(null==I?void 0:I.find((e=>e.userId===T.value)))return void uni.showToast({icon:"none",title:G("alreadyContact")});h(T.value),uni.showToast({title:G("requestSended")})}else k(T.value).then((()=>{uni.showToast({title:G("requestSended")})})).catch((e=>{var a;uni.showToast({icon:"none",title:null==(a=null==e?void 0:e.data)?void 0:a.error_description})}))};return(e,a)=>{const l=f,t=_;return u(),o(l,{class:"contact-search-wrap"},{default:n((()=>[d(l,{class:"search-title-wrap"},{default:n((()=>[d(l,{onClick:V,class:"back"},{default:n((()=>[c(i("<"))])),_:1}),d(l,{class:"title"},{default:n((()=>[c(i("contact"===p(w)?e.$t("addContact"):e.$t("addGroup")),1)])),_:1})])),_:1}),d(l,{class:"input-content-wrap"},{default:n((()=>[d(l,{class:"input-wrap"},{default:n((()=>[d(t,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=e=>T.value=e),onConfirm:L,placeholder:e.$t("searchPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),d(l,{onClick:V,class:"cancel"},{default:n((()=>[c(i(e.$t("cancel")),1)])),_:1})])),_:1}),d(l,{class:"search-content"},{default:n((()=>[x.value?(u(),o(l,{key:1,class:"search-result"},{default:n((()=>[d(l,{class:"search-result-item"},{default:n((()=>[d(l,{class:"info-wrap"},{default:n((()=>[d($,{src:"",placeholder:"contact"===p(w)?p(b):p(U)},null,8,["placeholder"]),d(l,{class:"user-id"},{default:n((()=>[c(i(T.value),1)])),_:1})])),_:1}),d(l,{class:"add",onClick:S},{default:n((()=>[c(i(e.$t("add")),1)])),_:1})])),_:1})])),_:1})):(u(),o(l,{key:0},{default:n((()=>[c(i(e.$t("searchNoContact")),1)])),_:1}))])),_:1})])),_:1})}}}),[["__scopeId","data-v-04b9972f"]]),L=T(e({__name:"index",setup(e){const l=a(),t=v(),g=m(),{t:C}=s(),{blockUser:y,unBlockUser:G}=t,U=r(""),T=r(!1),x=w((()=>t.blockList.includes(l.viewedUserInfo.userId))),L=()=>{l.setViewedUserInfo({userId:"",remark:""})},V=async()=>{await l.setContactRemark(l.viewedUserInfo.userId,U.value),l.setViewedUserInfo({userId:l.viewedUserInfo.userId,remark:U.value}),T.value=!1},S=async e=>{uni.showLoading();try{e.detail.value?await y(l.viewedUserInfo.userId):await G(l.viewedUserInfo.userId),uni.hideLoading()}catch(a){uni.hideLoading()}uni.hideLoading()},j=()=>{uni.navigateTo({url:`../../pages/Chat/index?type=singleChat&id=${l.viewedUserInfo.userId}`}),L()},A=w((()=>g.getUserInfoFromStore(l.viewedUserInfo.userId))),D=()=>{l.deleteContact(l.viewedUserInfo.userId).then((()=>{uni.showToast({title:C("deleteSuccess")}),L()}))};return(e,a)=>{const t=f,s=_,r=I,v=k;return u(),o(t,{class:"user-wrap"},{default:n((()=>[d(t,{class:"user-header-wrap"},{default:n((()=>[d(t,{onClick:L,class:"back"},{default:n((()=>[c(i("<"))])),_:1}),d(t,{class:"title"},{default:n((()=>[c(i(e.$t("contactDetail")),1)])),_:1})])),_:1}),d(t,{class:"user-info-wrap"},{default:n((()=>[d($,{class:"user-avatar",src:A.value.avatar,placeholder:p(b)},null,8,["src","placeholder"]),d(t,null,{default:n((()=>[d(t,{class:"remark"},{default:n((()=>[c(i(A.value.name),1)])),_:1}),d(t,{class:"user-id"},{default:n((()=>[c(i(p(l).viewedUserInfo.userId),1)])),_:1})])),_:1})])),_:1}),d(t,{class:"user-remark-wrap"},{default:n((()=>[d(t,null,{default:n((()=>[c(i(e.$t("remark"))+": ",1),h("span",null,i(T.value?"":p(l).viewedUserInfo.remark),1)])),_:1}),T.value?(u(),o(s,{key:0,class:"remark-input",onConfirm:V,placeholder:e.$t("remarkPlaceholder"),modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e)},null,8,["placeholder","modelValue"])):(u(),o(t,{key:1,onClick:a[1]||(a[1]=e=>T.value=!0)},{default:n((()=>[c(i(e.$t("editRemark")),1)])),_:1}))])),_:1}),d(t,{class:"user-block-wrap"},{default:n((()=>[d(t,null,{default:n((()=>[c(i(e.$t("blockList"))+":",1)])),_:1}),d(r,{checked:x.value,onChange:S},null,8,["checked"])])),_:1}),d(t,{class:"user-opt-wrap"},{default:n((()=>[d(v,{class:"opt-btn",type:"primary",onClick:j},{default:n((()=>[c(i(e.$t("sendMessage")),1)])),_:1}),d(v,{class:"opt-btn",type:"warn",onClick:D},{default:n((()=>[c(i(e.$t("deleteFriend")),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-a870cdeb"]]),V=T(e({__name:"index",setup(e){const a=l(),{t:t}=s(),r=()=>{a.setViewedGroupInfo({groupName:"",groupId:""})},_=()=>{uni.navigateTo({url:`../../pages/Chat/index?type=groupChat&id=${a.viewedGroupInfo.groupId}`}),r()},v=()=>{uni.navigateTo({url:`../../pages/GroupDetail/index?id=${a.viewedGroupInfo.groupId}`})},m=async()=>{await a.destroyGroup(a.viewedGroupInfo.groupId),r(),uni.showToast({title:t("destroyGroupSuccess")})},w=async()=>{await a.leaveGroup(a.viewedGroupInfo.groupId),r(),uni.showToast({title:t("leaveGroupSuccess")})};return(e,l)=>{const t=f,s=k;return u(),o(t,{class:"group-wrap"},{default:n((()=>[d(t,{class:"group-header-wrap"},{default:n((()=>[d(t,{onClick:r,class:"back"},{default:n((()=>[c(i("<"))])),_:1}),d(t,{class:"title"},{default:n((()=>[c(i(e.$t("groupDetail")),1)])),_:1})])),_:1}),d(t,{class:"group-info-wrap"},{default:n((()=>[d($,{class:"group-avatar",src:"",placeholder:p(U)},null,8,["placeholder"]),d(t,null,{default:n((()=>[d(t,{class:"groupname"},{default:n((()=>[c(i(p(a).viewedGroupInfo.groupName),1)])),_:1}),d(t,{class:"group-id"},{default:n((()=>[c("GroupId: "+i(p(a).viewedGroupInfo.groupId)+"（"+i(p(a).viewedGroupInfo.public?e.$t("publicGroup"):e.$t("privateGroup"))+"）",1)])),_:1})])),_:1})])),_:1}),d(t,{class:"group-opt-wrap"},{default:n((()=>[d(s,{class:"opt-btn",type:"primary",onClick:_},{default:n((()=>[c(i(e.$t("enterGroup")),1)])),_:1}),d(s,{class:"opt-btn",onClick:v},{default:n((()=>[c(i(e.$t("groupDetail")),1)])),_:1}),"owner"===p(a).viewedGroupInfo.role?(u(),o(s,{key:0,class:"opt-btn",type:"warn",onClick:m},{default:n((()=>[c(i(e.$t("destroyGroup")),1)])),_:1})):g("",!0),"owner"!==p(a).viewedGroupInfo.role?(u(),o(s,{key:1,class:"opt-btn",type:"warn",onClick:w},{default:n((()=>[c(i(e.$t("leaveGroup")),1)])),_:1})):g("",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-904cb188"]]),S=T(e({__name:"index",setup(e){const t=r(!0),s=r(!1),_=v(),w=a(),h=l(),I=m(),{getUserInfoFromStore:k}=I,{setViewedUserInfo:T}=w,{setViewedGroupInfo:S}=h,j=()=>{t.value=!0,s.value=!0},A=()=>{t.value=!1,s.value=!0},D=()=>{s.value=!1},F=()=>{uni.navigateTo({url:"../../pages/CreateGroup/index"})};return(e,a)=>{const l=f;return u(),o(l,{class:"contact-list-wrap"},{default:n((()=>[p(w).viewedUserInfo.userId?(u(),o(L,{key:0})):g("",!0),p(h).viewedGroupInfo.groupId?(u(),o(V,{key:1})):g("",!0),s.value?(u(),o(x,{key:2,searchType:t.value?"contact":"group",onOnCancel:D},null,8,["searchType"])):(u(),o(l,{key:3},{default:n((()=>[d(l,{class:"contact-search menu-item"},{default:n((()=>[d(l,{onClick:j},{default:n((()=>[c(i(e.$t("addContact"))+" >",1)])),_:1})])),_:1}),d(l,{class:"contact-search menu-item"},{default:n((()=>[d(l,{onClick:A},{default:n((()=>[c(i(e.$t("addGroup"))+" >",1)])),_:1})])),_:1}),d(l,{class:"menu-item"},{default:n((()=>[d(l,{onClick:F},{default:n((()=>[c(i(e.$t("createGroup"))+" >",1)])),_:1})])),_:1}),d(l,{class:"menu-item"},{default:n((()=>[c(i(e.$t("blockList")),1)])),_:1}),(u(!0),C(G,null,y(p(_).blockList,(e=>(u(),o(l,{class:"item-wrap",key:e},{default:n((()=>[d($,{class:"user-avatar",src:p(k)(e).avatar,placeholder:p(b)},null,8,["src","placeholder"]),d(l,{class:"item-name ellipsis"},{default:n((()=>[c(i(p(k)(e).name),1)])),_:2},1024)])),_:2},1024)))),128)),d(l,{class:"menu-item"},{default:n((()=>[c(i(e.$t("contact")),1)])),_:1}),d(l,{class:"items-wrap"},{default:n((()=>[(u(!0),C(G,null,y(p(w).contacts,(e=>(u(),o(l,{class:"item-wrap",key:e.userId,onClick:a=>(e=>{T(e)})(e)},{default:n((()=>[d($,{class:"user-avatar",src:p(k)(e.userId).avatar,placeholder:p(b)},null,8,["src","placeholder"]),d(l,{class:"item-name ellipsis"},{default:n((()=>[c(i(p(k)(e.userId).name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),d(l,{class:"menu-item"},{default:n((()=>[c(i(e.$t("groupList")),1)])),_:1}),d(l,{class:"items-wrap"},{default:n((()=>[(u(!0),C(G,null,y(p(h).joinedGroupList,(e=>(u(),o(l,{class:"item-wrap",key:e.groupId,onClick:a=>(e=>{S(e)})(e)},{default:n((()=>[d($,{class:"user-avatar",src:"",placeholder:p(U)},null,8,["placeholder"]),d(l,{class:"item-name ellipsis"},{default:n((()=>[c(i(e.groupName),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}))])),_:1})}}}),[["__scopeId","data-v-8efe8d67"]]);export{S as default};
