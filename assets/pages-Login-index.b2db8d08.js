import{d as e,u as a,a as o,r as l,I as n,o as t,c as s,w as i,b as r,e as d,t as u,f as c,g as h,i as p,h as v,j as m,k as w,l as g,m as f,n as T,p as k,C as y}from"./index-4af1eaa0.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";const b=C(e({__name:"index",setup(e){const{login:C}=a(),{t:b}=o(),_=l(60),I=l(""),P=l(""),V=l(""),$=l(""),x=l(!1),S=l(0),L=l(!!n),U=()=>{const e=setInterval((()=>{_.value--,_.value<=0&&(clearInterval(e),_.value=60)}),1e3)},E=async()=>{if(!/^1[3456789]\d{9}$/.test(V.value))return uni.showToast({title:b("telNumberError"),icon:"none"}),!1;try{U();const e=await uni.request({url:`https://a1.easemob.com/inside/app/sms/send/${V.value}`,header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:V.value}});200==e.statusCode?(U(),uni.showToast({title:b("sendCodeSuccess"),icon:"none"})):400==e.statusCode&&("phone number illegal"==e.data.errorInfo?uni.showToast({title:b("telNumberError"),icon:"none"}):"Please wait a moment while trying to send."==e.data.errorInfo?uni.showToast({title:b("sendCodeFrequent"),icon:"none"}):e.data.errorInfo.includes("exceed the limit")?uni.showToast({title:b("sendCodeReachLimit"),icon:"none"}):uni.showToast({title:e.data.errorInfo,icon:"none"}))}catch(e){uni.showToast({title:b("sendCodeFailed"),icon:"none"})}},N=()=>{if(x.value)if(L.value){if(""===I.value)return void uni.showToast({title:b("loginUserIdPlaceholder"),icon:"none"});uni.showLoading({title:b("loginLoadingTitle")}),C({user:I.value,pwd:P.value}).then((e=>{uni.setStorage({key:y,data:{userId:I.value,token:e.accessToken}}),uni.switchTab({url:"../ConversationList/index"})})).catch((e=>{var a,o;uni.showToast({title:null==(o=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:o.error_description,icon:"none"})})).finally((()=>{uni.hideLoading()}))}else{if(""===V.value)return void uni.showToast({title:b("loginPhoneIdPlaceholder"),icon:"none"});if(""===$.value)return void uni.showToast({title:b("loginCodePlaceholder"),icon:"none"});(async()=>{uni.showLoading({title:b("loginLoadingTitle")});try{const e=await uni.request({url:"https://a1.easemob.com/inside/app/user/login/V2",header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:V.value,smsCode:$.value}});if(200==e.statusCode){const{token:a,chatUserName:o}=e.data;C({user:o,accessToken:a}).then((e=>{uni.setStorage({key:y,data:{userId:o,token:e.accessToken}}),uni.switchTab({url:"../ConversationList/index"})})).finally((()=>{uni.hideLoading()}))}else if(400==e.statusCode&&e.data.errorInfo)switch(e.data.errorInfo){case"UserId password error.":uni.showToast({title:b("userIdOrPasswordError"),icon:"none"});break;case"phone number illegal":uni.showToast({title:b("telNumberError"),icon:"none"});break;case"SMS verification code error.":uni.showToast({title:b("codeError"),icon:"none"});break;case"Sms code cannot be empty":uni.showToast({title:b("codeIsEmpty"),icon:"none"});break;case"Please send SMS to get mobile phone verification code.":uni.showToast({title:b("sendCodeFirst"),icon:"none"});break;default:uni.showToast({title:e.data.errorInfo,icon:"none"})}}catch(e){console.log(e),uni.showToast({title:b("loginFailed"),icon:"none"})}})()}else uni.showToast({title:b("privacyChecked"),icon:"none"})},j=()=>{window.open("https://www.easemob.com/terms")},F=e=>{x.value=!!e.detail.value[0]},q=()=>{uni.navigateTo({url:"../ServerConfig/index"})};return(e,a)=>{const o=p,l=v,n=m,y=w,C=g,b=f,U=T,M=k;return t(),s(n,{class:"login-wrap"},{default:i((()=>[r(n,{class:"login-header"},{default:i((()=>[r(o,{onClick:a[0]||(a[0]=e=>S.value++),src:"/static/images/logo.png",style:{width:"100px",height:"100px"}}),r(l,{class:"login-title"},{default:i((()=>[d(u(e.$t("easemob"))+" IM Demo",1)])),_:1})])),_:1}),L.value?(t(),s(n,{key:0,class:"login-form-warp"},{default:i((()=>[r(n,{class:"input-wrap"},{default:i((()=>[r(y,{modelValue:I.value,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),placeholder:e.$t("loginUserIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),r(n,{class:"input-wrap"},{default:i((()=>[r(y,{type:"password",modelValue:P.value,"onUpdate:modelValue":a[2]||(a[2]=e=>P.value=e),placeholder:e.$t("loginPasswordPlaceholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1})):(t(),s(n,{key:1,class:"login-form-wrap"},{default:i((()=>[r(n,{class:"input-wrap"},{default:i((()=>[r(y,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=e=>V.value=e),maxlength:"11",placeholder:e.$t("loginPhoneIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),r(n,{class:"item-wrap"},{default:i((()=>[r(y,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),placeholder:e.$t("loginCodePlaceholder")},null,8,["modelValue","placeholder"]),r(C,{size:"mini",type:"primary",class:"send-code",onClick:E,disabled:60!==_.value},{default:i((()=>[d(u(60===_.value?e.$t("sendCode"):_.value),1)])),_:1},8,["disabled"])])),_:1})])),_:1})),r(n,{class:"private-wrap"},{default:i((()=>[r(M,{onChange:F},{default:i((()=>[r(U,null,{default:i((()=>[r(b,{value:"true",checked:x.value},null,8,["checked"]),d(" "+u(e.$t("agreeTo"))+" ",1),c("a",{onClick:j},"《"+u(e.$t("privacyPolicy"))+"》",1)])),_:1})])),_:1})])),_:1}),r(C,{type:"primary",onClick:N},{default:i((()=>[d(u(e.$t("login")),1)])),_:1}),S.value>5?(t(),s(n,{key:2,class:"server-config",onClick:q},{default:i((()=>[d(u(e.$t("serverConfig")),1)])),_:1})):h("",!0)])),_:1})}}}),[["__scopeId","data-v-2456228b"]]);export{b as default};
