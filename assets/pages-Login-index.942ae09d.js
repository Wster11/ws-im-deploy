import{d as e,u as a,a as o,r as l,I as n,o as t,c as s,w as i,b as r,e as d,t as u,f as c,g as h,h as p,i as m,j as v,k as w,l as g,m as f,n as T,p as b,q as k,C as y}from"./index-0db897ad.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";const _=C(e({__name:"index",setup(e){const{login:C}=a(),{t:_}=o(),I=l(60),P=l(""),V=l(""),x=l(""),$=l(""),S=l(!1),L=l(0),U=l(!!n),E=()=>{const e=setInterval((()=>{I.value--,I.value<=0&&(clearInterval(e),I.value=60)}),1e3)},N=async()=>{if(!/^1[3456789]\d{9}$/.test(x.value))return uni.showToast({title:_("telNumberError"),icon:"none"}),!1;try{E();const e=await uni.request({url:`https://a1.easemob.com/inside/app/sms/send/${x.value}`,header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:x.value}});200==e.statusCode?(E(),uni.showToast({title:_("sendCodeSuccess"),icon:"none"})):400==e.statusCode&&("phone number illegal"==e.data.errorInfo?uni.showToast({title:_("telNumberError"),icon:"none"}):"Please wait a moment while trying to send."==e.data.errorInfo?uni.showToast({title:_("sendCodeFrequent"),icon:"none"}):e.data.errorInfo.includes("exceed the limit")?uni.showToast({title:_("sendCodeReachLimit"),icon:"none"}):uni.showToast({title:e.data.errorInfo,icon:"none"}))}catch(e){uni.showToast({title:_("sendCodeFailed"),icon:"none"})}},j=()=>{if(S.value)if(U.value){if(""===P.value)return void uni.showToast({title:_("loginUserIdPlaceholder"),icon:"none"});uni.showLoading({title:_("loginLoadingTitle")}),C({user:P.value,pwd:V.value}).then((e=>{uni.setStorage({key:y,data:{userId:P.value,token:e.accessToken}}),uni.switchTab({url:"../ConversationList/index"})})).catch((e=>{var a,o;uni.showToast({title:null==(o=null==(a=null==e?void 0:e.data)?void 0:a.data)?void 0:o.error_description,icon:"none"})})).finally((()=>{uni.hideLoading()}))}else{if(""===x.value)return void uni.showToast({title:_("loginPhoneIdPlaceholder"),icon:"none"});if(""===$.value)return void uni.showToast({title:_("loginCodePlaceholder"),icon:"none"});(async()=>{uni.showLoading({title:_("loginLoadingTitle")});try{const e=await uni.request({url:"https://a1.easemob.com/inside/app/user/login/V2",header:{"content-type":"application/json"},method:"POST",data:{phoneNumber:x.value,smsCode:$.value}});if(200==e.statusCode){const{token:a,chatUserName:o}=e.data;C({user:o,accessToken:a}).then((e=>{uni.setStorage({key:y,data:{userId:o,token:e.accessToken}}),uni.switchTab({url:"../ConversationList/index"})})).finally((()=>{uni.hideLoading()}))}else if(400==e.statusCode&&e.data.errorInfo)switch(e.data.errorInfo){case"UserId password error.":uni.showToast({title:_("userIdOrPasswordError"),icon:"none"});break;case"phone number illegal":uni.showToast({title:_("telNumberError"),icon:"none"});break;case"SMS verification code error.":uni.showToast({title:_("codeError"),icon:"none"});break;case"Sms code cannot be empty":uni.showToast({title:_("codeIsEmpty"),icon:"none"});break;case"Please send SMS to get mobile phone verification code.":uni.showToast({title:_("sendCodeFirst"),icon:"none"});break;default:uni.showToast({title:e.data.errorInfo,icon:"none"})}}catch(e){console.log(e),uni.showToast({title:_("loginFailed"),icon:"none"})}})()}else uni.showToast({title:_("privacyChecked"),icon:"none"})},q=()=>{window.open("https://www.easemob.com/terms")},F=e=>{S.value=!!e.detail.value[0]},M=()=>{uni.navigateTo({url:"../ServerConfig/index"})};return(e,a)=>{const o=m,l=v,y=w,C=g,_=f,E=T,O=b,z=k;return t(),s(y,{class:"login-wrap"},{default:i((()=>[r(y,{class:"login-header"},{default:i((()=>[r(o,{onClick:a[0]||(a[0]=e=>L.value++),src:"/static/images/logo.png",style:{width:"100px",height:"100px"}}),r(l,{class:"login-title"},{default:i((()=>[d(u(e.$t("easemob"))+" IM Demo",1)])),_:1})])),_:1}),U.value?(t(),s(y,{key:0,class:"login-form-warp"},{default:i((()=>[r(y,{class:"input-wrap"},{default:i((()=>[r(C,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),placeholder:e.$t("loginUserIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),r(y,{class:"input-wrap"},{default:i((()=>[r(C,{type:"password",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value=e),placeholder:e.$t("loginPasswordPlaceholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1})):(t(),s(y,{key:1,class:"login-form-wrap"},{default:i((()=>[r(y,{class:"input-wrap"},{default:i((()=>[r(C,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=e=>x.value=e),maxlength:"11",placeholder:e.$t("loginPhoneIdPlaceholder")},null,8,["modelValue","placeholder"])])),_:1}),r(y,{class:"item-wrap"},{default:i((()=>[r(C,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),maxlength:"6",placeholder:e.$t("loginCodePlaceholder")},null,8,["modelValue","placeholder"]),r(_,{size:"mini",type:"primary",class:"send-code",onClick:N,disabled:60!==I.value},{default:i((()=>[d(u(60===I.value?e.$t("sendCode"):I.value),1)])),_:1},8,["disabled"])])),_:1})])),_:1})),r(y,{class:"private-wrap"},{default:i((()=>[r(z,{onChange:F},{default:i((()=>[r(O,{class:"label"},{default:i((()=>[r(E,{value:"true",checked:S.value},null,8,["checked"]),d(" "+u(e.$t("agreeTo"))+" ",1),c("a",{onClick:q},"《"+u(e.$t("privacyPolicy"))+"》",1)])),_:1})])),_:1})])),_:1}),r(_,{type:"primary",onClick:j},{default:i((()=>[d(u(e.$t("login")),1)])),_:1}),L.value>5||h(n)?(t(),s(y,{key:2,class:"server-config",onClick:M},{default:i((()=>[d(u(e.$t("serverConfig")),1)])),_:1})):p("",!0)])),_:1})}}}),[["__scopeId","data-v-2c2b9ce8"]]);export{_ as default};
